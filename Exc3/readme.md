## Проблемы и риски, связанные с планируемым ростом нагрузки

Текущая архитектура уже демонстрирует узкие места и невозможность горизонтального масштабирования.
- Добавлены таймеры на выгрузку данных по ночам и каждые 15 минут, это блокирует горизонтальное масштабирование сервисов ins-product-aggregator и ins-comp-settlement.
- Все запросы являются синхронными, это значит, что каждый сервис является точкой отказа всей системы и каждый сервис в цепочке должен валидно и вовремя ответить.
- Проблема вытекающая из вышеописанной, если один из сервисов страховых компаний ответит не верно или с не приемлемой задержкой, то данные по этому обновлению могут быть утеряными.
- Что бы снизить нагрузку на сервис core-app, запросы на получение данных по зарегистрированным заявкам осуществляются 1 раз в сутки, что искуственно создаёт задержку регистрации\оплаты, а так же если будет обрыв сети, то зарегистрированные заявки так и не будут обработаны до следующего запуска выгрузки.
- Управление временем выгрузок пока работает, но когда страховых станет больше, то сервис может не успевать выгружать все данные за приемлемое время, и это в свою очередь сильно ударит по его доступности.
- Расширение количества страховых компаний, только усугубит вышеописанные проблемы.


## Решение по новой архитектуре

- В предложенной архитектуре, взаимодействие между сервисами можно реализовать в виде "Event-Streaming". А именно, когда в топике REGISTRATION_INSURANCE появляется запись, её считывает consumer и в процессоре обогащает необходимыми данными из сервиса "ins-product-aggregator" по средствам запроса GRAPHQL, после этого сохраняет данные в БД "ins-comp-settlement-db", а после отправляет данные в топик "CREATE_PAYMENT", что бы отправить данные по взаиморасщётам в страховую компанию. Тут так же нужно реализовать паттерн "Transactional Outbox".  
- Паттерн "Transactional Outbox" так же должен быть реализован в сервисе "core-app", что бы сервис "ins-comp-settlement" не терял не одной записи.
- Паттерн "Transactional Outbox" должен быть применён и в сервисах адаптерах insurance-company-n, что бы не было потери данных.